- content_for :css do
  = stylesheet_link_tag 'jquery-carousel-evolution/carousel.css'
- content_for :javascript do
  = javascript_include_tag 'jquery-carousel-evolution/jquery-1.4.4.min.js', 'jquery-carousel-evolution/jquery.mousewheel.min.js', 'jquery-carousel-evolution/jquery.carousel-1.1.js'
  :javascript
    $(document).ready(function(){
      $('.carousel').carousel({
        hAlign:'left', 
        vAlign:'center', 
        hMargin:1.1,
        vMargin:0.2, 
        frontWidth:200, 
        frontHeight:665, 
        carouselWidth:1200, 
        carouselHeight:890, 
        left:0, 
        right:0, 
        top:0, 
        bottom:0, 
        backZoom:0.8, 
        slidesPerScroll:5, 
        speed:500, 
        buttonNav:'none', 
        directionNav:false,
        autoplay:false, 
        autoplayInterval:5000, 
        pauseOnHover:true, 
        mouse:true, 
        shadow:false, 
        reflection:true, 
        reflectionHeight:0.2, 
        reflectionOpacity:0.5, 
        reflectionColor:'255,255,255',
        description:true, descriptionContainer:'.description',
        backOpacity:1,
        before: function(carousel){}, 
        after: function(carousel){perform_bundle_hacks()}

      });                              
      perform_bundle_hacks();
    });

    function perform_bundle_hacks() {
      sincronizar_carousel_con_descripciones();
      blur_image();
    }

    function sincronizar_carousel_con_descripciones() {
      slides = $('.slides');
      descripciones = $('.product-description .indexed');
      

      descripciones.each(function() {
        current_z_index = slides.find('.indexed:eq(' + $(this).index() +')').css('z-index');
        $(this).css('z-index', current_z_index);

        sincronizar_y_desvanecer($(this));
        
      });
    }

    function sincronizar_y_desvanecer(this_current) {
      var z_index_highest = 0;
      var index_current = parseInt(this_current.css('z-index'));
        if (index_current > z_index_highest) {
          z_index_highest = index_current;
        }
      
       descripciones.hide();
       $('.product-description .indexed:eq(' + z_index_highest + ')').fadeIn();
    }

    function blur_assign(this_current) {
      slide_z_index_highest = 0;
      slide_z_index_highest_prev = 0;
      var index_current = parseInt(this_current.css('z-index'));

      if (index_current > slide_z_index_highest) {
          slide_z_index_highest = index_current;
          slide_z_index_highest_prev = index_current-1;
       }
    }

    function blur_image() {
      blur_false = 'regular';
      blur = 'blurred';
      slides_list = slides.find('.indexed');
      blur_first_image(); 

      slides_list.click(function() {
        current_slide = $(this).find('img');
        current_slide_src = current_slide.attr('src');
        current_slide_src_blur = current_slide_src.replace(blur, blur_false);

        blur_undo();
        current_slide.attr('src', current_slide_src_blur);
      });

    }

    function blur_undo() {
      slides_list.each(function() {
        all_slides = $(this).find('img');
        all_slides_src = all_slides.attr('src');
        all_slides_src_blur_false = all_slides_src.replace(blur_false, blur);
        all_slides.attr('src', all_slides_src_blur_false);
      });
    }

    function blur_first_image() {
      first_image = slides_list.eq(0).find('img');
      first_image_src = first_image.attr('src');
      first_image_src_blur_false = first_image_src.replace(blur, blur_false);

      first_image.attr('src', first_image_src_blur_false);
    }
